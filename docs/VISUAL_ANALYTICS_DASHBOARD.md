# Visual Analytics & Dashboard

This document explains the Streamlit dashboard: architecture, data flow, tabs, components, and how it consumes pipeline outputs.

---

## Overview

- Goal: Provide an interactive UI to explore themes, sub-themes, topics, universities, and trends.
- Stack: Streamlit + Plotly (dark theme styling). Modular tabs and utilities.
- Inputs: Processed papers, theme mapping, and trend analysis JSON generated by the pipeline.

---

## Key Files and Roles

- `dashboard/app.py`
  - Entrypoint. Sets up page, loads data, renders filters and tabs.
- `dashboard/utils/data_loader.py`
  - `load_data()` reads `PROCESSED_PAPERS_CSV`, `TREND_ANALYSIS_PATH`, `TOPIC_MAPPING_PATH` and adds derived scores (`confidence`, `recency_score`, `citation_score`, `relevance_score`). Handles sub-theme mapping and normalizes university names.
- `dashboard/components/filters.py`
  - `render_filters(...)` sidebar filters: date range, themes, sub-themes, universities, and keyword search. Returns filtered DataFrame and selections.
- Tabs:
  - `dashboard/tabs/overview_tab.py` – key insights, KPIs, hierarchy sunburst, overall activity.
  - `dashboard/tabs/theme_analysis_tab.py` – priorities, publication trends, sub-theme analysis, research flow (Sankey).
  - `dashboard/tabs/universities_tab.py` – university comparisons (see file for specifics).
  - `dashboard/tabs/trends_tab.py` – multi-theme trend comparison, lifecycle analysis, heatmap, recommendations.
  - `dashboard/tabs/emerging_topics_tab.py` – emerging topics bubble chart and insights.
- Utils:
  - `dashboard/utils/visualizations.py` – Plotly figures (sunburst, Sankey, timeline, heatmap, impact bubble, radar).
  - `dashboard/utils/styling.py` – helper for consistent dark theme and section headers.
  - `dashboard/utils/insights.py` – computed insights and the emerging topics bubble helper.
- Config:
  - `config/settings.py` – `PROCESSED_PAPERS_CSV`, `TREND_ANALYSIS_PATH`, `TOPIC_MAPPING_PATH`, etc.
  - `config/themes.py` – theme names/order for displays.

---

## Data Flow into the Dashboard

- Data files produced by pipeline steps:
  - Step 3/4/5 outputs are required:
    - `data/processed/papers_processed.csv`
    - `data/processed/topic_mapping.json`
    - `data/processed/trend_analysis.json`
- The loader (`load_data`) applies:
  - Date parsing
  - Theme/sub-theme mapping (fallback to mapping if original theme not present)
  - Confidence percentage normalization
  - Recency/citation/relevance scores
  - Quarter field for trends

---

## Filters and State

- Sidebar filters (persisted via `st.session_state` keys: `from_date`, `to_date`, `themes`, `sub_themes`, `all_unis_flag`, `unis`, `kw`).
- Inline popover filters in `app.py` mirror the sidebar state for quick tweaks per tab.
- Data is filtered by date range, selected themes and sub-themes, universities, and optional keyword search across title/abstract.

---

## Visuals and Interactions

- Overview:
  - AI-generated insights (from `dashboard/utils/insights.py`)
  - KPIs for papers, topics, sub-themes, universities, avg growth
  - Hierarchy sunburst: Theme → Sub-Theme → Topic (from `create_sunburst_chart`)
  - Papers per theme and top sub-themes with confidence heat coloring
- Theme Analysis:
  - Strategic priority cards (colored by growth rate)
  - Publication timeline area chart
  - Sankey flow: Theme → Sub-theme → University
  - Theme-specific sub-theme breakdown and top universities; adjacent themes by keyword overlap
- Trends:
  - Multi-theme trend comparison
  - Sub-theme lifecycle lines
  - Sub-theme activity heatmap
  - Strategy recommendations (growth, investment gaps, collaboration focus)
- Emerging Topics:
  - Recency vs growth bubble chart (size by volume), with quadrant guidance and cards for “hot topics,” “momentum leaders,” and “recent surges.”

---

## Running the Dashboard

- Ensure the pipeline has produced the required files.
- Then run:
```powershell
streamlit run dashboard/app.py
```

If files are missing, the app shows an error banner asking you to run the pipeline.

---

## Notes and Tips

- Styling: `dashboard/theme.css` and `utils/styling.py` apply a consistent dark theme with accessible colors.
- Performance: Large datasets benefit from `@st.cache_data` in `load_data()`.
- Dates: Keep `date` in ISO format; the loader converts to pandas datetime and computes `quarter`.

---

## Flow diagram (Visual Analytics & Dashboard)

```mermaid
flowchart TD
    subgraph Inputs
        P[papers_processed.csv\n(data/processed)]
        Map[topic_mapping.json\n(data/processed)]
        Tr[trend_analysis.json\n(data/processed)]
    end

    L[load_data()\n(parse + scores + sub-themes + quarter)]
    F[render_filters()\n(date/themes/sub-themes/unis/keywords)]
    T1[Overview Tab]
    T2[Theme Analysis Tab]
    T3[Universities Tab]
    T4[Trends Tab]
    T5[Emerging Topics Tab]

    P --> L
    Map --> L
    Tr --> L
    L --> F --> T1 & T2 & T3 & T4 & T5

    classDef inp fill:#eef,stroke:#88a,stroke-width:1px;
    class P,Map,Tr inp;
```
